
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.ejabberd.im/developer/guide/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../extending-ejabberd/pubsub/">
      
      
      <link rel="icon" href="../../assets/img/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Developer Guide - ejabberd Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22m10.5%2024-1.485-9.007-8.961-1.738L8.16%209.06%207.045%200l6.495%206.414%208.271-3.861-4.093%208.16%206.228%206.673-9.024-1.372z%22/%3E%3C/svg%3E');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M3%2021v-3.71l7.78-4.49%203.77%202.2L21%2011.25V21zM21%208.94l-6.45%203.73-3.77-2.17L3%2015v-2.21l7.78-4.49%203.77%202.2L21%206.75z%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/css/mdversion.css">
    
      <link rel="stylesheet" href="../../assets/css/notes.css">
    
      <link rel="stylesheet" href="../../assets/css/status.css">
    
      <link rel="stylesheet" href="../../assets/css/headers-underline.css">
    
      <link rel="stylesheet" href="../../assets/css/ezglossary.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ejabberd-developer-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ejabberd Docs" class="md-header__button md-logo" aria-label="ejabberd Docs" data-md-component="logo">
      
  <img src="../../assets/img/logo-docs.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ejabberd Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Developer Guide
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/processone/ejabberd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    processone/ejabberd
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../get-started/" class="md-tabs__link">
          
  
  
    
  
  Overview

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../admin/install/" class="md-tabs__link">
          
  
  
    
  
  Install

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../admin/configuration/" class="md-tabs__link">
          
  
  
    
  
  Configure

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../admin/guide/" class="md-tabs__link">
          
  
  
    
  
  Advanced

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ejabberd-api/" class="md-tabs__link">
          
  
  
    
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../archive/" class="md-tabs__link">
          
  
  
    
  
  Archive

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../roadmap/" class="md-tabs__link">
          
  
  
    
  
  Roadmap

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ejabberd Docs" class="md-nav__button md-logo" aria-label="ejabberd Docs" data-md-component="logo">
      
  <img src="../../assets/img/logo-docs.png" alt="logo">

    </a>
    ejabberd Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/processone/ejabberd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    processone/ejabberd
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../get-started/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Features
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ejabberd-faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../use-cases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Use Cases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../COPYING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SECURITY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../README-GIT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../admin/install/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Install
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Install
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTAINER/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Containers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/install/binary-installer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Binary Installers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/install/os-package/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operating System Package
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/install/source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compile Source Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/install/homebrew/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Homebrew
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install-osx/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mac OSX
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/install/next-steps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Next Steps
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../admin/configuration/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Configure
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Configure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/configuration/file-format/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Format
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/configuration/basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/configuration/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Authentication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/configuration/database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Databases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/configuration/ldap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LDAP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/configuration/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/configuration/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/configuration/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/configuration/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../admin/guide/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending-ejabberd/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/guide/clustering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Clustering
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/guide/managing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Managing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/guide/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules / Contrib
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/guide/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/guide/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/mix-010/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     MIX tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/guide/mqtt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     MQTT tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/muc-hats/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     MUC Hats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/muc-vcard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     MUC vCards
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/mysql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     MySQL tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label=" ">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
       
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coding-style-convention" class="md-nav__link">
    <span class="md-ellipsis">
      Coding style convention
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coding style convention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#format" class="md-nav__link">
    <span class="md-ellipsis">
      Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indent-with-emacs" class="md-nav__link">
    <span class="md-ellipsis">
      Indent with Emacs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-up-procedure" class="md-nav__link">
    <span class="md-ellipsis">
      Start-up procedure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    <span class="md-ellipsis">
      Core
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-layer" class="md-nav__link">
    <span class="md-ellipsis">
      Network Layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xmpp-stream-layer" class="md-nav__link">
    <span class="md-ellipsis">
      XMPP Stream Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing-layer" class="md-nav__link">
    <span class="md-ellipsis">
      Routing Layer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-new-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      Adding new functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adding new functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iq-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      IQ Handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hooks" class="md-nav__link">
    <span class="md-ellipsis">
      Hooks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gen_mod-behaviour" class="md-nav__link">
    <span class="md-ellipsis">
      gen_mod behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stateful-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Stateful modules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gen_mod-module" class="md-nav__link">
    <span class="md-ellipsis">
      gen_mod module
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    <span class="md-ellipsis">
      Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetching-options" class="md-nav__link">
    <span class="md-ellipsis">
      Fetching options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-xmpp-library" class="md-nav__link">
    <span class="md-ellipsis">
      Using XMPP library
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using XMPP library">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xmpp-module" class="md-nav__link">
    <span class="md-ellipsis">
      xmpp module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jid-module" class="md-nav__link">
    <span class="md-ellipsis">
      jid module
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      External Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extauth-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Extauth Interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#perl-example-script" class="md-nav__link">
    <span class="md-ellipsis">
      Perl Example Script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-example-script" class="md-nav__link">
    <span class="md-ellipsis">
      Python Example Script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending-ejabberd/pubsub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     Pubsub Dev
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xmpp-clients-bots/extensions/roster-versioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     Simplified Roster Versioning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending-ejabberd/stanza-routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     Stanza Routing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sql-schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     SQL Schema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/contrib/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     Contributor Convenant
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/CONTRIBUTORS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
     Contributors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repositories/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependencies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../README-DOCS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending-ejabberd/elixir/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Elixir Dev
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../livebooks/ejabberd-developer-livebook/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Livebook
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending-ejabberd/localization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Localization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending-ejabberd/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Development
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xmpp-clients-bots/extensions/muc-sub/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MUC/Sub Extension
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../extending-ejabberd/testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vscode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VSCode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xmpp-clients-bots/ios/getting-started-xmppframework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    XMPPFramework (iOS)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../ejabberd-api/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ejabberd-api/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ejabberd-api/admin-tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ejabberd-api/simple-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simple Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ejabberd-api/permissions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Permissions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ejabberd-api/oauth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OAuth Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ejabberd-api/commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commands
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ejabberd-api/api_versioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Versioning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/25.04/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    25.04
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            25.04
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.04/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.04/admin-tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.04/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.04/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.04/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.04/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.04/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 25.04
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/25.03/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    25.03
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            25.03
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.03/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.03/admin-tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.03/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.03/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.03/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.03/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/25.03/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 25.03
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/24.12/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    24.12
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_4">
            <span class="md-nav__icon md-icon"></span>
            24.12
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.12/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.12/admin-tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.12/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.12/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.12/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.12/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.12/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 24.12
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/24.10/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    24.10
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_5" id="__nav_7_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_5">
            <span class="md-nav__icon md-icon"></span>
            24.10
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.10/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.10/admin-tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.10/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.10/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.10/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.10/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.10/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 24.10
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/24.07/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    24.07
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_6" id="__nav_7_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_6">
            <span class="md-nav__icon md-icon"></span>
            24.07
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.07/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.07/admin-tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.07/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.07/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.07/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.07/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.07/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 24.07
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/24.06/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    24.06
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_7" id="__nav_7_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_7">
            <span class="md-nav__icon md-icon"></span>
            24.06
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.06/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.06/admin-tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.06/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.06/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.06/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.06/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.06/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 24.06
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/24.02/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    24.02
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_8" id="__nav_7_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_8">
            <span class="md-nav__icon md-icon"></span>
            24.02
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.02/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.02/admin-tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.02/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.02/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.02/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.02/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/24.02/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 24.02
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/23.10/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    23.10
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_9" id="__nav_7_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_9">
            <span class="md-nav__icon md-icon"></span>
            23.10
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.10/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.10/admin-tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.10/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Option
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.10/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.10/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.10/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.10/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 23.10
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/23.04/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    23.04
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_10" id="__nav_7_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_10">
            <span class="md-nav__icon md-icon"></span>
            23.04
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.04/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.04/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Option
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.04/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.04/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.04/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.04/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 23.04
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/23.01/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    23.01
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_11" id="__nav_7_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_11">
            <span class="md-nav__icon md-icon"></span>
            23.01
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.01/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.01/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Option
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.01/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.01/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.01/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/23.01/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 23.01
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/22.10/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    22.10
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_12" id="__nav_7_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_12">
            <span class="md-nav__icon md-icon"></span>
            22.10
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.10/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.10/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Option
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.10/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.10/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.10/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.10/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 22.10
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/22.05/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    22.05
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_13" id="__nav_7_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_13">
            <span class="md-nav__icon md-icon"></span>
            22.05
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.05/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.05/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Option
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.05/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.05/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.05/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/22.05/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 22.05
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_14" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/21.12/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    21.12
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_14" id="__nav_7_14_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_14">
            <span class="md-nav__icon md-icon"></span>
            21.12
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.12/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.12/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Option
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.12/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.12/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.12/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.12/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 21.12
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_15" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/21.07/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    21.07
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_15" id="__nav_7_15_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_15">
            <span class="md-nav__icon md-icon"></span>
            21.07
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.07/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.07/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Option
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.07/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.07/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.07/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.07/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 21.07
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_16" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/21.04/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    21.04
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_16" id="__nav_7_16_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_16">
            <span class="md-nav__icon md-icon"></span>
            21.04
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.04/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.04/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Option
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.04/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.04/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.04/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.04/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 21.04
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_17" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/21.01/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    21.01
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_17" id="__nav_7_17_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_17">
            <span class="md-nav__icon md-icon"></span>
            21.01
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.01/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.01/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Option
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.01/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.01/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/21.01/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_18" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/20.12/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    20.12
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_18" id="__nav_7_18_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_18">
            <span class="md-nav__icon md-icon"></span>
            20.12
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.12/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.12/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Option
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.12/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.12/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.12/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_19" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/20.07/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    20.07
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_19" id="__nav_7_19_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_19">
            <span class="md-nav__icon md-icon"></span>
            20.07
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.07/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.07/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.07/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.07/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.07/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_20" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/20.04/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    20.04
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_20" id="__nav_7_20_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_20_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_20">
            <span class="md-nav__icon md-icon"></span>
            20.04
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.04/admin-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.04/listen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.04/listen-options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Listen Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.04/modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules Options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.04/toplevel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Top-Level Options
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_21" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/20.03/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    20.03
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_21_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_21">
            <span class="md-nav__icon md-icon"></span>
            20.03
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_22" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/20.02/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    20.02
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_22_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_22">
            <span class="md-nav__icon md-icon"></span>
            20.02
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_23" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../archive/20.01/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    20.01
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_23" id="__nav_7_23_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_23_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_23">
            <span class="md-nav__icon md-icon"></span>
            20.01
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/20.01/upgrade/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 20.01
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_24" >
        
          
          <label class="md-nav__link" for="__nav_7_24" id="__nav_7_24_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Older releases
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_24_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_24">
            <span class="md-nav__icon md-icon"></span>
            Older releases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_19.05_to_19.08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 19.08
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_19.02_to_19.05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 19.05
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_18.12_to_19.02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 19.02
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_18.09_to_18.12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 18.12
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_18.06_to_18.09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 18.09
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_18.04_to_18.06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 18.06
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_18.03_to_18.04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 18.04
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_18.01_to_18.03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 18.03
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_17.11_to_18.01/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 18.01
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_17.09_to_17.11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 17.11
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_17.06_to_17.09/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 17.09
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_17.03_to_17.06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 17.06
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_16.08_to_17.03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 17.03
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_16.06_to_16.08/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 16.08
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_16.04_to_16.06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 16.06
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_16.03_to_16.04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 16.04
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_16.02_to_16.03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 16.03
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_15.11_to_16.02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade to ejabberd 16.02
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/older-releases/from_2.1.1x_to_16.02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Upgrade from 2.1.1x to 16.02
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../archive/old/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configure 20.03
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CHANGELOG/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ChangeLog
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../roadmap/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Roadmap
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Roadmap
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label=" ">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
       
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coding-style-convention" class="md-nav__link">
    <span class="md-ellipsis">
      Coding style convention
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coding style convention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#format" class="md-nav__link">
    <span class="md-ellipsis">
      Format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#indent-with-emacs" class="md-nav__link">
    <span class="md-ellipsis">
      Indent with Emacs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-up-procedure" class="md-nav__link">
    <span class="md-ellipsis">
      Start-up procedure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    <span class="md-ellipsis">
      Core
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-layer" class="md-nav__link">
    <span class="md-ellipsis">
      Network Layer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Network Layer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xmpp-stream-layer" class="md-nav__link">
    <span class="md-ellipsis">
      XMPP Stream Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routing-layer" class="md-nav__link">
    <span class="md-ellipsis">
      Routing Layer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-new-functionality" class="md-nav__link">
    <span class="md-ellipsis">
      Adding new functionality
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adding new functionality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iq-handlers" class="md-nav__link">
    <span class="md-ellipsis">
      IQ Handlers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hooks" class="md-nav__link">
    <span class="md-ellipsis">
      Hooks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gen_mod-behaviour" class="md-nav__link">
    <span class="md-ellipsis">
      gen_mod behaviour
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stateful-modules" class="md-nav__link">
    <span class="md-ellipsis">
      Stateful modules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gen_mod-module" class="md-nav__link">
    <span class="md-ellipsis">
      gen_mod module
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    <span class="md-ellipsis">
      Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetching-options" class="md-nav__link">
    <span class="md-ellipsis">
      Fetching options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-xmpp-library" class="md-nav__link">
    <span class="md-ellipsis">
      Using XMPP library
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using XMPP library">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xmpp-module" class="md-nav__link">
    <span class="md-ellipsis">
      xmpp module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jid-module" class="md-nav__link">
    <span class="md-ellipsis">
      jid module
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      External Authentication
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External Authentication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extauth-interface" class="md-nav__link">
    <span class="md-ellipsis">
      Extauth Interface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#perl-example-script" class="md-nav__link">
    <span class="md-ellipsis">
      Perl Example Script
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-example-script" class="md-nav__link">
    <span class="md-ellipsis">
      Python Example Script
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="ejabberd-developer-guide">ejabberd Developer Guide<a class="headerlink" href="#ejabberd-developer-guide" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>This guide is a brief explanation of ejabberd internals. It is not
intended to be a comprehensive ejabberd's internal API documentation.
You still need to read and understand ejabberd's source code.</p>
<p>This guide should help you to understand ejabberd's code faster:
it provides entry points from where to start reading relevant parts of
the code and ignore irrelevant ones.</p>
<p>Note that there is absolutely no
need to know every line of code of ejabberd, but some parts are crucial
to understand.</p>
<p>In order to read and understand the guide you must be pretty fluent with
Erlang programming language and understand basics of the XMPP protocol:
there is no detailed explanation of Erlang syntax and/or features and
it's assumed that you're familiar with such terms as <code>xml stream</code>,
<code>stanza</code>, <code>c2s</code>, <code>s2s</code> and so on. If you see these words for the first
time in your life you're unlikely to understand the guide.</p>
<h2 id="coding-style-convention">Coding style convention<a class="headerlink" href="#coding-style-convention" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>NOTE</strong>: this section is only relevant for ejabberd contributors. If
you're hacking ejabberd for internal needs, you are free to choose
whatever coding style you like.</p>
</blockquote>
<p>ejabberd follows <a href="https://github.com/inaka/erlang_guidelines/blob/main/README.md">Erlang Coding Standards &amp;
Guidelines</a>
or at least tries to do so: there is still a lot of poorly written
legacy code (which is being leisurely rewritten), but the new code
should be written with keeping these rules in mind. In some cases the
rules can be bypassed, but the reason doing so should be really
weighty. The rules shouldn't be ignored just because a contributor
doesn't like them.</p>
<p>The typical coding style rules found violated in contributors' code are:</p>
<ul>
<li><a href="https://github.com/inaka/erlang_guidelines/blob/main/README.md#100-column-per-line">100 column per line</a>:
in fact we have defined 80 columns as a soft and 100 columns as a hard
limit, which means most of your lines should be no longer than 80
characters and the rest must never be longer than 100 characters.</li>
<li><a href="https://github.com/inaka/erlang_guidelines/blob/main/README.md#avoid-deep-nesting">no deep
nesting</a></li>
<li><a href="https://github.com/inaka/erlang_guidelines/blob/main/README.md#avoid-boolean-parameters">no boolean parameters in case
control</a></li>
<li><a href="https://github.com/inaka/erlang_guidelines/blob/main/README.md#variable-names">only CamelCase variables
name</a></li>
<li><a href="https://github.com/inaka/erlang_guidelines/blob/main/README.md#no-macros">no
macros</a></li>
<li><a href="https://github.com/inaka/erlang_guidelines/blob/main/README.md#dont-use-case-catch">no
case-catch</a></li>
</ul>
<p>It's worth noting that the code itself should be indented using Emacs
indentation style (that is the standard indentation style for Erlang
programs). If you're not using Emacs for ejabberd development, indent
the code using it first before making a PR/commit.</p>
<h3 id="format">Format<a class="headerlink" href="#format" title="Permanent link">&para;</a></h3>
<p><span class="mdx-badge"><span class="mdx-badge__icon"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.41 11.58-9-9A2 2 0 0 0 11 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 .59 1.42l9 9A2 2 0 0 0 13 22a2 2 0 0 0 1.41-.59l7-7A2 2 0 0 0 22 13a2 2 0 0 0-.59-1.42M13 20l-9-9V4h7l9 9M6.5 5A1.5 1.5 0 1 1 5 6.5 1.5 1.5 0 0 1 6.5 5"/></svg></span></span> <span class="mdx-badge__text">added in <a href="../../archive/24.06/index.md">24.06</a></span></span></p>
<p>You can completely reformat your source code to the standard
by surrounding the desired code with directives <code>@format-begin</code> and <code>@format-end</code>,
for example:
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c">%% @format-begin</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nf">foo</span><span class="p">(</span><span class="n">xx</span><span class="w">   </span><span class="p">,</span><span class="n">yy</span><span class="p">)</span><span class="w">  </span><span class="o">-&gt;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">        </span><span class="n">xxyy</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nf">foo</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span><span class="nv">B</span><span class="p">)</span><span class="o">-&gt;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nv">A</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">           </span><span class="o">+</span><span class="nv">B</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">   </span><span class="p">.</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="c">%% @format-end</span>
</span></code></pre></div></p>
<p>then run <code>make format</code> and it will format and indent all the instructed lines and files.
The resulting source code will be:
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c">%% @format-begin</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nf">foo</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="w"> </span><span class="n">yy</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="n">xxyy</span><span class="p">;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="nf">foo</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span><span class="w"> </span><span class="nv">B</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="nv">A</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">B</span><span class="p">.</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c">%% @format-end</span>
</span></code></pre></div></p>
<p>This can be applied to any desired part of your module, or all of it,
see for example <a href="https://github.com/processone/ejabberd/blob/master/src/mod_adhoc_api.erl">mod_adhoc_api.erl</a>.
In that file, the <code>@format-begin</code> directive is provided early in the file,
and the <code>@format-end</code> directive is not even needed.</p>
<p>You can integrate that step in your development cycle,
for example configuring your git to automatically run
that procedure before pushing your changes to the upstream repository.
For that, add a file in your local ejabberd git repository
named <code>.git/hooks/pre-push</code> with the following content:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="ch">#!/bin/sh</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;---&gt; Formatting source code...&quot;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>./tools/rebar3-format.sh<span class="w"> </span>./rebar3
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="k">if</span><span class="w"> </span>git<span class="w"> </span>diff<span class="w"> </span>--quiet<span class="w"> </span>--exit-code<span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="k">else</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;---&gt; After formatting ejabberd source code, some files have changed:&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span>git<span class="w"> </span>status<span class="w"> </span>--short
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;---&gt; Please review those changes and include them in your commit before pushing upstream.&quot;</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="k">fi</span>
</span></code></pre></div>
<p>Furthermore, you can add an alias in git:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>git<span class="w"> </span>config<span class="w"> </span>--global<span class="w"> </span>alias.format<span class="w"> </span><span class="s1">&#39;!$(pwd)/.git/hooks/pre-push&#39;</span>
</span></code></pre></div>
and now you can run the hook easily anytime:
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>git format
</span></code></pre></div></p>
<h3 id="indent-with-emacs">Indent with Emacs<a class="headerlink" href="#indent-with-emacs" title="Permanent link">&para;</a></h3>
<p>If you are only interested in lines indentation, not in full code formatting,
install Emacs and surround the desired code or the whole file with lines:
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c">%% @indent-begin</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nf">foo</span><span class="p">(</span><span class="nv">A</span><span class="p">,</span><span class="nv">B</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="nv">A</span><span class="o">+</span><span class="nv">B</span><span class="p">.</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="c">%% @indent-end</span>
</span></code></pre></div>
then run <code>make indent</code> and it will call Emacs to indent all the instructed files.</p>
<h2 id="start-up-procedure">Start-up procedure<a class="headerlink" href="#start-up-procedure" title="Permanent link">&para;</a></h2>
<p>ejabberd is written as a standard OTP application, so the startup
module can be found in <code>src/ejabberd.app.src</code> or, if ejabberd is
compiled, in <code>ebin/ejabberd.app</code> file: that is, <code>ejabberd_app.erl</code>
module from where <code>start/2</code> function is called by Erlang application
controller. This function makes some initialization (such as logger,
mnesia, configuration file, etc.) and ends up by starting the main
ejabberd supervisor - <code>ejabberd_sup</code>. Thus, for further startup order
refer to <code>ejabberd_sup.erl</code> module (this is a simple list-like module
with supervisor childspecs).</p>
<blockquote>
<p><strong>WARNING</strong>: only "core stuff" should be attached to <code>ejabberd_sup</code>.
For attaching modules use gen_mod's supervisor (via
<code>gen_mod:start_child/3,4</code> functions), for attaching database backend
modules use <code>ejabberd_backend_sup</code> supervisor, etc.</p>
</blockquote>
<p>Once <code>ejabberd_sup</code> is started, ejabberd application is considered to
be started.</p>
<h2 id="core">Core<a class="headerlink" href="#core" title="Permanent link">&para;</a></h2>
<p>The ejabberd core is not well-defined. Moreover, the described core
layers are pure abstraction grouping several modules together by some
criteria for better understanding of ejabberd internal processing rules.</p>
<h2 id="network-layer">Network Layer<a class="headerlink" href="#network-layer" title="Permanent link">&para;</a></h2>
<p>Once ejabberd is started, some external events should obviously make it
doing something. Besides explicit administrative commands, the most
relevant such events are incoming connections. Incoming connections are
handled inside <code>Network Layer</code>. The layer implemented by
<code>ejabberd_listener.erl</code>, <code>ejabberd_receiver.erl</code> and
<code>ejabberd_socket.erl</code> modules.</p>
<blockquote>
<p><strong>NOTE</strong>: <code>ejabberd_listner.erl</code> is able to handle raw TCP and UDP
connections, however only XMPP connections are described here.</p>
</blockquote>
<p>Once a connection is accepted by <code>ejabberd_listener.erl</code>, an instance
(a process) of <code>ejabberd_receiver.erl</code> is started and it becomes the
socket owner, where it performs the following operations:</p>
<ul>
<li>Throttles a connection using shapers from <code>shaper.erl</code> module</li>
<li>Performs TLS decoding using
<a href="https://github.com/processone/fast_tls">fast_tls</a> library</li>
<li>Performs stream decompression using
<a href="https://github.com/processone/ezlib">ezlib</a> library</li>
<li>Parses incoming raw XML data into <code>#xmlel{}</code> packets using
<a href="https://github.com/processone/fast_xml">fast_xml</a> library</li>
</ul>
<p><code>ejabberd_socket.erl</code> does the same but in a reverse order, i.e. it
performs stream compression and/or TLS encoding, serializes <code>#xmlel{}</code>
packets into raw XML data and puts them into a socket (note that
shapers do not apply for outgoing data).</p>
<p>Once <code>xmlel{}</code> packet is constructed by <code>ejabberd_receiver.erl</code> it's
passed to <code>XMPP Stream Layer</code>.</p>
<h3 id="xmpp-stream-layer">XMPP Stream Layer<a class="headerlink" href="#xmpp-stream-layer" title="Permanent link">&para;</a></h3>
<p><code>XMPP Stream Layer</code> is represented by <code>xmpp_stream_in.erl</code> and
<code>xmpp_stream_out.erl</code> modules. An instance (i.e. a process) of
<code>xmpp_stream_in.erl</code> is started along with an instance of
<code>ejabberd_receiver.erl</code> and all incoming <code>#xmlel{}</code> packets are passed
from the latter to the former. <code>xmpp_stream_in.erl</code> module does the
following:</p>
<ul>
<li>Encodes/decodes <code>#xmlel{}</code> packets using
<a href="https://github.com/processone/xmpp">xmpp</a> library from/to internal
structures (records) defined in
<a href="https://github.com/processone/xmpp/blob/master/include/xmpp_codec.hrl">xmpp_codec.hrl</a>.</li>
<li>Performs negotiation of <em>inbound</em> XMPP streams</li>
<li>Performs STARTTLS negotiation (if needed)</li>
<li>Performs compression negotiation (if needed)</li>
<li>Performs SASL authentication</li>
</ul>
<blockquote>
<p><strong>NOTE</strong>: <code>XMPP Stream Layer</code> was only introduced in ejabberd 17.03.
Prior to this XMPP stream negotiation was handled inside <code>ejabberd_c2s.erl</code>,
<code>ejabberd_s2s_in.erl</code>, <code>ejabberd_service.erl</code> and <code>ejabberd_s2s_out.erl</code>.
This has lead to unmaintainable monolithic spaghetti code with a lot
of code duplication between these modules. It's believed introducing
<code>xmpp_stream_in.erl</code> and <code>xmpp_stream_out.erl</code> modules now solves this
problem.</p>
</blockquote>
<p>During these procedures <code>xmpp_stream_in.erl</code> calls functions from its
callback modules, i.e. the modules of <code>xmpp_stream_in</code> behaviour:
<code>ejabberd_c2s.erl</code>, <code>ejabberd_s2s_in.erl</code> or <code>ejabberd_service.erl</code>,
depending on the stream namespace.</p>
<p><code>xmpp_stream_out.erl</code> does the same but for <em>outbound</em> XMPP streams.
The only its callback module is <code>ejabberd_s2s_out.erl</code>.</p>
<blockquote>
<p><strong>NOTE</strong>: <code>xmpp_stream_in.erl</code> shares the same process and state with
its callback modules, i.e. functions from <code>xmpp_stream_in.erl</code> and
functions from <code>ejabberd_c2s/s2s_in/service.erl</code> modules are
evaluated inside the same process. This is also true for
<code>xmpp_stream_out.erl</code> and <code>ejabberd_s2s_out.erl</code>. The state is
represented by a <code>map()</code> in both cases.</p>
</blockquote>
<h4 id="ejabberd_c2s-ejabberd_s2s_in-and-ejabberd_service">ejabberd_c2s, ejabberd_s2s_in and ejabberd_service<a class="headerlink" href="#ejabberd_c2s-ejabberd_s2s_in-and-ejabberd_service" title="Permanent link">&para;</a></h4>
<p>These are modules of <code>xmpp_stream_in</code> behaviour. The only purpose of
these modules is to provide callback functions for <code>xmpp_stream_in.erl</code>
module. Examples of such callback functions are:</p>
<ul>
<li><code>tls_enabled/1</code>: tells whether or not TLS is enabled in the configuration</li>
<li><code>check_password_fun/1</code>: provides a function for SASL authentication</li>
<li><code>handle_authenticated_packet/2</code>: what to do with packets after
authentication is completed</li>
</ul>
<p>Roughly, they represent an intermediate (or "glue") code between
<code>XMPP Stream Layer</code> and <code>Routing Layer</code> for inbound XMPP streams.</p>
<p><code>ejabberd_s2s_out.erl</code> is described <a href="#ejabberd_s2s-and-ejabberd_s2s_out">elsewhere</a></p>
<h3 id="routing-layer">Routing Layer<a class="headerlink" href="#routing-layer" title="Permanent link">&para;</a></h3>
<h4 id="ejabberd_router">ejabberd_router<a class="headerlink" href="#ejabberd_router" title="Permanent link">&para;</a></h4>
<p><code>ejabberd_router.erl</code> module is the main dispatcher of XMPP stanzas.</p>
<p>It's pretty small and straightforward module whose the only task is to
find the "route" for a stanza. <code>ejabberd_router.erl</code> only operates with
<code>#message{}</code>, <code>#presence{}</code> and <code>#iq{}</code> packets (defined in
<a href="https://github.com/processone/xmpp/blob/master/include/xmpp_codec.hrl">xmpp_codec.hrl</a>),
so please note, that it is not possible to route arbitrary <code>#xmlel{}</code>
packets or any other Erlang terms through <code>ejabberd_router</code>.</p>
<p>The only valid routes are:</p>
<ul>
<li><em>local</em> route: stanzas of this route type are destined to the local
server itself, i.e. stanzas with <code>to</code> attribute in the form of
<code>domain.com</code> or <code>domain.com/resource</code>, where <code>domain.com</code> is a virtual
host serviced by ejabberd. <code>ejabberd_router</code> passes such stanzas to
<code>ejabberd_local.erl</code> module via <code>ejabberd_local:route/1</code> function call.</li>
<li><em>session manager</em> route: stanzas of this route type are destined to
local users, i.e. stanzas with <code>to</code> attribute in the form of
<code>user@domain.com</code> or <code>user@domain.com/resource</code> where <code>domain.com</code> is a
virtual host serviced by ejabberd. <code>ejabberd_router</code> passes such
stanzas to <code>ejabberd_sm.erl</code> module via <code>ejabberd_sm:route/1</code> function
call.</li>
<li><em>registered</em> route: if a stanza is not destined to local virtual
host, ejabberd first checks if there is a "registered" route for the
stanza, i.e. a domain registered via <code>ejabberd_router:register_route/2</code>
function. For doing this it looks up the routing table and if there is
a process <code>Pid</code> registered on this domain, ejabberd routes the stanza
as <code>Pid ! {route, Stanza}</code>. The routing table is backend-dependent and
is implemented in the corresponding backend module such as
<code>ejabberd_router_mnesia.erl</code>.</li>
<li><em>s2s</em> route: if a stanza is neither destined to local virtual host
nor to registered route, <code>ejabberd_router</code> passes it to
<code>ejabberd_s2s.erl</code> module via <code>ejabberd_s2s:route/1</code> function call.</li>
</ul>
<p>Mentioned modules are explained in more details in the following
sections. You're encouraged to inspect exported functions of
<code>ejabberd_router.erl</code>, because most likely you will use some of them.</p>
<h4 id="ejabberd_local">ejabberd_local<a class="headerlink" href="#ejabberd_local" title="Permanent link">&para;</a></h4>
<p><code>ejabberd_local.erl</code> handles stanzas destined to the local server
itself. For <code>#message{}</code> and <code>#presence{}</code> it only calls hooks, while
for <code>#iq{}</code> it finds the corresponding "IQ handler" by looking up its
internal table to find a correspondence between a namespace of IQ's
child element and the handler. Once the handler (an erlang function) is
found, it passes further IQ processing to <code>gen_iq_handler.erl</code> via
<code>gen_iq_handler:handle/5</code> call.</p>
<p><code>ejabberd_local.erl</code> is also able to send IQ requests and to process
responses for them. This is implemented in <code>ejabberd_local:route_iq/2,3</code>
functions. This is also the most notable function of the module.
Calling to other functions is not recommended.</p>
<h4 id="ejabberd_sm">ejabberd_sm<a class="headerlink" href="#ejabberd_sm" title="Permanent link">&para;</a></h4>
<p><code>ejabberd_sm.erl</code> handles stanzas destined to local users. For
<code>#message{}</code>, <code>#presence{}</code> and full-JID <code>#iq{}</code> it looks up its
internal table (aka <code>session</code> table) for the corresponding
<code>ejabberd_c2s</code> process and, if the process is found, it routes the
stanza to this process via <code>ejabberd_c2s:route/2</code> call.</p>
<p>Bare-JID <code>#iq{}</code> stanzas are processed in a similar way as in
<code>ejabberd_local.erl</code>. The internal <code>session</code> table is backend-dependent
and is implemented in the corresponding backend module:
<code>ejabberd_sm_mnesia.erl</code>, <code>ejabberd_sm_redis.erl</code> and so on.</p>
<p>The most notable functions of the module are:</p>
<ul>
<li><code>get_user_resources/2</code></li>
<li><code>dirty_get_sessions_list/0</code></li>
<li><code>dirty_get_my_sessions_list/0</code></li>
<li><code>get_vh_session_list/1</code></li>
<li><code>get_vh_session_number/1</code></li>
<li><code>get_vh_by_backend/1</code></li>
<li><code>get_session_pid/3</code></li>
<li><code>get_user_info/2</code></li>
<li><code>get_user_info/3</code></li>
<li><code>get_user_ip/3</code></li>
<li><code>is_existing_resource/3</code></li>
</ul>
<h4 id="route-registered-processes">route-registered processes<a class="headerlink" href="#route-registered-processes" title="Permanent link">&para;</a></h4>
<p>Any process can register a route to itself. It's done by calling to
<code>ejabberd_router:route/2</code> function. Note that a route should be
unregistered via <code>ejabberd_router:unregister_route/1</code> function if the
registering process terminates or the route is no longer needed. Once a
route is registered to a process, this process will receive Erlang
messages in the form of <code>{route, Stanza}</code>.</p>
<blockquote>
<p><strong>NOTE</strong>: <code>from</code> and <code>to</code> fields are always set in the <code>Stanza</code>,
so it's safe to assume that <code>xmpp:get_from(Stanza)</code> and
<code>xmpp:get_to(Stanza)</code> always return <code>#jid{}</code> and never <code>undefined</code>.</p>
</blockquote>
<p>Refer to the code of <code>mod_muc.erl</code> or <code>ejabberd_service.erl</code> for an
example of a route-registered process.</p>
<h4 id="ejabberd_s2s-and-ejabberd_s2s_out">ejabberd_s2s and ejabberd_s2s_out<a class="headerlink" href="#ejabberd_s2s-and-ejabberd_s2s_out" title="Permanent link">&para;</a></h4>
<p>If a stanza is destined neither to local virtual host not to a
route-registered process, it's passed to <code>ejabberd_s2s.erl</code> module via
<code>ejabberd_s2s:route/1</code> function call. <code>ejabberd_s2s</code> in its turn will
look up the internal table (currently it's <code>s2s</code> Mnesia table) for the
<code>ejabberd_s2s_out</code> process and, if found, passes the stanza to this
process or, otherwise, will start new <code>ejabberd_s2s_out</code> process.</p>
<p><code>ejabberd_s2s_out.erl</code> handles <em>outbound</em> XMPP S2S streams. This is the
only callback module of <code>xmpp_stream_out</code> behaviour.</p>
<h2 id="adding-new-functionality">Adding new functionality<a class="headerlink" href="#adding-new-functionality" title="Permanent link">&para;</a></h2>
<p>There are two common ways to add new functionality to ejabberd:</p>
<ul>
<li>using <a href="#iq-handlers">IQ Handlers</a></li>
<li>using <a href="#hooks">hooks</a></li>
</ul>
<p>Here is a rule of thumb on which way to choose:</p>
<ul>
<li>if you want to handle newly introduced IQs (that is, to generate
replies for them), use <a href="#iq-handlers">IQ handlers</a></li>
<li>if you want to modify ejabberd behaviour along the way of a stanza
passing through all layers or want to "listen" for some internal events
(like ejabberd configuration change), use <a href="#hooks">hooks</a>.</li>
</ul>
<h3 id="iq-handlers">IQ Handlers<a class="headerlink" href="#iq-handlers" title="Permanent link">&para;</a></h3>
<p>An <code>IQ Handler</code> is a function processing an IQ stanza (internally
represented as <code>#iq{}</code> record). There are two types of IQ handlers:
<code>local</code> and <code>sm</code>.</p>
<ul>
<li><code>local</code> IQ handler is a function processing IQs coming from
<code>ejabberd_local</code>, that is, an IQ destined to the local server itself as
described in <a href="#ejabberd_local">ejabberd_local</a>.</li>
<li><code>sm</code> IQ handler is a function processing IQs coming from
<code>ejabberd_sm</code>, that is, a bare-JID IQ destined to a local user as
described in <a href="#ejabberd_sm">ejabberd_sm</a>.</li>
</ul>
<p>An IQ handler is registered as:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nn">gen_iq_handler</span><span class="p">:</span><span class="nf">add_iq_handler</span><span class="p">(</span><span class="nv">Type</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ejabberd_local</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">ejabberd_sm</span><span class="p">,</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">                              </span><span class="nv">Host</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">binary</span><span class="p">(),</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">                              </span><span class="nv">Namespace</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">binary</span><span class="p">(),</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">                              </span><span class="nv">Module</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">module</span><span class="p">(),</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">                              </span><span class="nv">Function</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">atom</span><span class="p">())</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ok</span>
</span></code></pre></div>
<p>where:</p>
<ul>
<li><code>Type</code> is <code>ejabberd_local</code> for <code>local</code> handlers or <code>ejabberd_sm</code> for
<code>sm</code> handlers</li>
<li><code>Host</code> is a virtual host for which the IQ is to be processed</li>
<li><code>Namespace</code> is an XML namespace of IQ's child element</li>
</ul>
<p>Once registered, matching <code>IQ</code> stanzas are handled by calling
<code>Module:Function(IQ)</code>. The result should be in the form of <code>#iq{}</code> or
<code>ignore</code>. When <code>#iq{}</code> is returned, it's treated as a reply and routed
back to the IQ originator, otherwise, if <code>ignore</code> is returned, the
further processing stops.</p>
<blockquote>
<p><strong>NOTE</strong>: <code>from</code> and <code>to</code> fields are always set in the <code>IQ</code>,
so it's safe to assume that <code>xmpp:get_from(IQ)</code> and
<code>xmpp:get_to(IQ)</code> always return <code>#jid{}</code> and never <code>undefined</code>.</p>
</blockquote>
<p>If a handler is no longer needed it should be unregistered as:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nn">gen_iq_handler</span><span class="p">:</span><span class="nf">remove_iq_handler</span><span class="p">(</span><span class="nv">Type</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">ejabberd_local</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">ejabberd_sm</span><span class="p">,</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">                                 </span><span class="nv">Host</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">binary</span><span class="p">(),</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">                                 </span><span class="nv">Namespace</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">binary</span><span class="p">())</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ok</span>
</span></code></pre></div>
<p>with the same meaning of the arguments.</p>
<h3 id="hooks">Hooks<a class="headerlink" href="#hooks" title="Permanent link">&para;</a></h3>
<p>When ejabberd is processing an arbitrary event (incoming IQ, outgoing
presence, configuration change, etc), it is convenient to consider some
of them notable. In order for someone to be notified of such events,
ejabberd executes "hooks". A hook is represented by a unique name. All
functions associated with the hook's name will be called in some
specified order.</p>
<blockquote>
<p><strong>NOTE</strong>: The conception of hooking is not ejabberd specific, see
<a href="https://en.wikipedia.org/wiki/Hooking">Hooking</a> Wikipedia page for a
general description.</p>
</blockquote>
<p>For example, when a packet is received on a client connection, ejabberd
runs <code>user_send_packet</code> hook. Several modules need to listen for an
event represented by this hook (that is, a packet and a C2S state),
so they associate their internal functions with it: <code>mod_ping.erl</code>
associates <code>user_send/1</code> function, <code>mod_privacy.erl</code> associates
<code>user_send_packet/1</code> function and so on. The event is passed as an
argument to the "hooked" functions, thus, the function from
<code>mod_ping.erl</code> will be called as <code>mod_ping:user_send({Stanza,
C2SState})</code>, the function from <code>mod_privacy.erl</code> will be called as
<code>mod_privacy:user_send_packet({Stanza, C2SState})</code> and so on.</p>
<p>There are two types of hooks: <em>with</em> an accumulator and <em>without</em> an
accumulator.</p>
<ul>
<li>a hook with an accumulator, as its name suggests, accumulates some
state during execution of a list of associated functions: the first
argument of the hooked function will always be an accumulator and the
function must return the new value for the accumulator (whether it's
modified or not) in the form of <code>NewAcc</code> or <code>{stop, NewAcc}</code>. If <code>{stop, NewAcc}</code>
is returned, a hook is considered evaluated and next functions
in its associated list are not called. Otherwise, the new value
<code>NewAcc</code> is passed to the next function in the associated list. An
example of hooks with accumulator are: <code>disco_info</code>, <code>filter_packet</code>,
<code>muc_process_iq</code> and so on.</li>
<li>a hook without accumulator doesn't accumulate anything during
execution of a list of associated functions: the returning values of
such functions are simply ignored unless <code>stop</code> is returned. In the
latter case, evaluation of next functions in the associated list is not
performed. An example of hooks without accumulator are:
<code>config_reloaded</code>, <code>component_init</code> and so on.</li>
</ul>
<p>Both types of hooks have <em>local</em> or <em>global</em> scope.</p>
<ul>
<li>a hook with local scope is associated with particular virtual host
and is run only when an event is matching this host. Most of the hooks
have local scope.</li>
<li>a hook with global scope is not associated with any virtual host and
is run for an event matching any hosts. A very few hooks have global
scope.</li>
</ul>
<p>A function gets associated with a local hook as follows (the type of a
hook doesn't matter):</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nn">ejabberd_hooks</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">Hook</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">atom</span><span class="p">(),</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">                   </span><span class="nv">Host</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">binary</span><span class="p">(),</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">                   </span><span class="nv">Module</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">module</span><span class="p">(),</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">                   </span><span class="nv">Function</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">atom</span><span class="p">(),</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">                   </span><span class="nv">Seq</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">integer</span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ok</span>
</span></code></pre></div>
<p>where:</p>
<ul>
<li><code>Hook</code> is a hook name</li>
<li><code>Host</code> is a virtual host</li>
<li><code>Seq</code> is a sequence number. This number defines position of the
function in the list to maintain execution order. Functions with lower
sequence number are executed <em>before</em> those with bigger sequence
number. For functions with the same sequence number the order is
unspecified. A function associated with an accumulating hook is called
as <code>Module:Function(Acc, Arg1, Arg2, ...)</code> where <code>Acc</code> is an
accumulator value, <code>Arg1</code>, <code>Arg2</code>, ... - arguments of the hook. Recall
that such function must return a new accumulator value (whether it's
modified or not) in the form of <code>NewAcc</code> or <code>{stop, NewAcc}</code> where
<code>NewAcc</code> is the new accumulator value. A function associated with a
hook without an accumulator is called as <code>Module:Function(Arg1,
Arg2, ...)</code>. All returning values except <code>stop</code> are ignored.</li>
</ul>
<blockquote>
<p><strong>WARNING</strong>: a <code>Function</code> with the corresponding arity should be
exported by a <code>Module</code></p>
</blockquote>
<p>A function for a global hook gets associated as follows (the type of a
hook doesn't matter):</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nn">ejabberd_hooks</span><span class="p">:</span><span class="nf">add</span><span class="p">(</span><span class="nv">Hook</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">atom</span><span class="p">(),</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">                   </span><span class="nv">Module</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">module</span><span class="p">(),</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">                   </span><span class="nv">Function</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">atom</span><span class="p">(),</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">                   </span><span class="nv">Seq</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">integer</span><span class="p">())</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ok</span>
</span></code></pre></div>
<p>with the same meaning of the arguments. Note that <code>Host</code> argument is
omitted in this case.</p>
<p>For any types of hooks, if an association is no longer needed, it can
be deleted by calling <code>ejabberd_hooks:delete/5,6</code> functions with
exactly the same arguments used to create an association.</p>
<p>In some cases a new hook should be introduced. There is no need to
explicitly register the new hook, one only needs to run a hook in the
required place. The following functions can be used for this:</p>
<ul>
<li>for local hooks with accumulator: <code>ejabberd_hooks:run_fold(Hook,
Host, Acc, Args)</code>. The function returns a new accumulator value.</li>
<li>for local hooks without accumulator: <code>ejabberd_hooks:run(Hook, Host,
Args)</code>. The function always returns <code>ok</code>.</li>
<li>for global hooks with accumulator: <code>ejabberd_hooks:run_fold(Hook,
Acc, Args)</code>. The function returns a new accumulator value.</li>
<li>for global hooks without accumulator: <code>ejabbed_hooks:run(Hook,
Args)</code>. The function always returns <code>ok</code>.</li>
</ul>
<p>where <code>Args</code> is a list of arguments (other variables have the same
meaning as above).</p>
<p>There is a helper script that you can use to
check hook correctness and find mishooked functions. The script also
generates a module <code>src/hooks_type_test.erl</code> from where you can learn
about existing hooks and check execution order. You can place your code
inside <code>src</code> directory (if any), and run:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>make<span class="w"> </span>hooks
</span></code></pre></div>
<h2 id="modules">Modules<a class="headerlink" href="#modules" title="Permanent link">&para;</a></h2>
<h3 id="gen_mod-behaviour">gen_mod behaviour<a class="headerlink" href="#gen_mod-behaviour" title="Permanent link">&para;</a></h3>
<p>As you might know, ejabberd is a modular software. The best method to
add new functionality to it is to write a new module. For doing this
one should create an Erlang module of <code>gen_mod</code> behaviour:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c">%% file mod_foo.erl</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">mod_foo</span><span class="p">).</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="p">...</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="p">-</span><span class="ni">behaviour</span><span class="p">(</span><span class="n">gen_mod</span><span class="p">).</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="p">...</span>
</span></code></pre></div>
<p>Several callbacks should be defined in the module:</p>
<ul>
<li><code>Module:start(Host, Opts)</code> where <code>Host</code> is a virtual host where the
module is about to start and <code>Opts</code> is an option list (typically
defined in the <code>modules</code> section of <code>ejabberd.yml</code>). The function is
executed when a module is being started. It is intended to initialize a
module. This is a good place to register hooks and IQ handlers, as well
as to create an initial state of a module (if needed). The function
should return either <code>ok</code> or <code>{ok, pid()}</code>.</li>
<li><code>Module:stop(Host)</code> where <code>Host</code> is a virtual host. The function is
executed when a module is being stopped. It is intended to make some
module cleanup: most likely unregistering hooks and IQ handlers. The
returning value is ignored</li>
<li><code>Module:reload(Host, NewOpts, OldOpts)</code> where <code>NewOpts</code> and <code>OldOpts</code>
is the new and old options list respectively. The function is called
every time a module is being reloaded. This is the only optional callback,
thus, if undefined, the module will be reloaded by calling sequentially
<code>Module:stop/1</code> and <code>Module:start/2</code>.</li>
<li><code>Module:depends(Host, Opts)</code> where the meaning of the arguments is
the same. The function is called to build modules dependencies on
startup. The function must return a list of type <code>[{module(), DependencyType}]</code>,
where <code>DependencyType</code> is one of <code>hard</code> or <code>soft</code>.
The <code>hard</code> dependency means the module is non-functional if the other
module is not loaded. The <code>soft</code> dependency means the module has
suboptimal functionality if the other module is not loaded.</li>
<li><code>Module:mod_opt_type(Option)</code>. The function is used to process
configuration options of <code>Module</code>. The function has the same meaning
as <code>Module:opt_type/1</code> callback described in
<a href="#validation">Configuration validation</a> section.</li>
</ul>
<h3 id="stateful-modules">Stateful modules<a class="headerlink" href="#stateful-modules" title="Permanent link">&para;</a></h3>
<p>While some modules don't need to maintain an internal state
("stateless" modules), others are required to do this ("stateful"
modules). The common practice is to implement a stateful module as a
<code>gen_server</code> process. There is a couple of helpers to deal with such
modules:</p>
<ul>
<li><code>gen_mod:start_child(Module, Host, Opts)</code> where <code>Module</code> is a name of
a stateful module. This function should be called as the last function
inside of <code>Module:start/2</code>. It will create a <code>gen_server</code> process with
a registered name and will attach it to <code>ejabberd_gen_mod_sup</code> supervisor.</li>
<li><code>gen_mod:stop_child(Module, Host)</code> should be used inside of
<code>Module:stop/1</code> function and will terminate the corresponding
registered <code>gen_server</code> process.</li>
<li><code>gen_mod:get_module_proc(Host, Module)</code> can be used to obtain a
registered name of a stateful module (i.e. its <code>gen_server</code>'s name).</li>
</ul>
<blockquote>
<p><strong>WARNING</strong>: don't forget to set <code>process_flag(trap_exit, true)</code>
inside <code>Module:init/1</code> callback function, otherwise,
<code>Module:terminate/2</code> callback will never be called when a module is
being stopped.</p>
<p><strong>WARNING</strong>: keeping module's configuration options in an internal
state is not recommended. Use <code>gen_mod:get_module_opt/4,5</code> functions
to retrieve the options: in this case you don't need to re-initialize
options in the state inside <code>Module:reload/3</code> callback.</p>
</blockquote>
<p>If a stateful module is intended to maintain a state in the form of a
table, <code>ETS</code> can be used for this. In this case there is no need to
implement it as a <code>gen_server</code> process. But make sure you're not
calling <code>ets:new/2</code> several times for several virtual hosts (<code>badarg</code>
will be raised in this case). E.g., the following code is
<em>incorrect</em>:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nf">start</span><span class="p">(</span><span class="nv">Host</span><span class="p">,</span><span class="w"> </span><span class="nv">Opts</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="p">...</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="nn">ets</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span><span class="n">some_table</span><span class="p">,</span><span class="w"> </span><span class="n">named_table</span><span class="p">,</span><span class="w"> </span><span class="p">...]),</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="p">...</span>
</span></code></pre></div>
<p>The correct code will look something like that:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nf">start</span><span class="p">(</span><span class="nv">Host</span><span class="p">,</span><span class="w"> </span><span class="nv">Opts</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="p">...</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="nn">ets</span><span class="p">:</span><span class="nf">new</span><span class="p">(</span><span class="n">some_table</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">named_table</span><span class="p">,</span><span class="w"> </span><span class="p">...])</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">_:</span><span class="n">badarg</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="k">end</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="p">...</span>
</span></code></pre></div>
<p>There is a plenty of examples of modules: pick up any file starting
with <code>mod_</code> inside <code>src</code> directory.</p>
<h3 id="gen_mod-module">gen_mod module<a class="headerlink" href="#gen_mod-module" title="Permanent link">&para;</a></h3>
<p>Module <code>gen_mod.erl</code> has various useful functions to work with modules,
the most notable are:</p>
<ul>
<li><code>is_loaded/2</code>: whether or not the module in question is loaded at
a given virtual host</li>
<li><code>get_opt/3,4</code>: gets a value of an option from module's options list
(see description of <code>ejabberd_config:get_option/3</code> function from
<a href="#fetching-options">Fetching configuration options</a> for details)</li>
<li><code>get_module_opt/4,5</code>: the same as above, but an option is referenced
by a virtual host and a module.</li>
</ul>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>ejabberd has quite powerful configuration processor -
<code>ejabberd_config.erl</code>. It performs configuration file parsing and
validation.</p>
<h3 id="validation">Validation<a class="headerlink" href="#validation" title="Permanent link">&para;</a></h3>
<p>In order to validate options <code>ejabberd_config</code> has to install feedback
with the rest of the code. For doing this, it provides
<code>ejabberd_config</code> behaviour with a single callback function:
<code>Module:opt_type/1</code>. The callback accepts an option name as an <code>atom()</code>
and must return either validating function if an option is known for
the <code>Module</code> or a list of available options (as a list of atoms). A
validating function is a <code>fun()</code> of a single argument - the value of
the option. The validating function must return any new value for the
option (whether it's modified or not) or should crash if the value
doesn't match expected format. Here is an example:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c">%% file: some.erl</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="p">-</span><span class="ni">module</span><span class="p">(</span><span class="n">some</span><span class="p">).</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="p">-</span><span class="ni">behaviour</span><span class="p">(</span><span class="n">ejabberd_config</span><span class="p">).</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="p">-</span><span class="ni">export</span><span class="p">([</span><span class="n">opt_type</span><span class="o">/</span><span class="mi">1</span><span class="p">]).</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="p">...</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="nf">opt_type</span><span class="p">(</span><span class="n">max_connections_number</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="c">%% max_connections_number should be non-negative integer</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">    </span><span class="c">%% if the condition is satisfied, return this integer</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">    </span><span class="c">%% fail with function_clause otherwise</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">    </span><span class="k">fun</span><span class="p">(</span><span class="nv">I</span><span class="p">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="nb">is_integer</span><span class="p">(</span><span class="nv">I</span><span class="p">),</span><span class="w"> </span><span class="nv">I</span><span class="o">&gt;=</span><span class="mi">0</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="k">end</span><span class="p">;</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="nf">opt_type</span><span class="p">(_)</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="c">%% only max_connections_number is known</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w">    </span><span class="p">[</span><span class="n">max_connections_number</span><span class="p">].</span>
</span></code></pre></div>
<blockquote>
<p><strong>NOTE</strong>: <code>gen_mod</code> behaviour defines a very similar callback -
<code>Module:mod_opt_type/1</code> with the same meaning of arguments and
returning values, except the callback is called to validate the
<code>Module</code>'s specific options (i.e. options defined in the
corresponding subsection of the <code>modules</code> section of a configuration
file).</p>
</blockquote>
<h3 id="fetching-options">Fetching options<a class="headerlink" href="#fetching-options" title="Permanent link">&para;</a></h3>
<p>The most notable function of the module is:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nf">get_option</span><span class="p">(</span><span class="nv">Option</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">atom</span><span class="p">()</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="p">{</span><span class="n">atom</span><span class="p">(),</span><span class="w"> </span><span class="n">binary</span><span class="p">()</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">global</span><span class="p">},</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">           </span><span class="nv">ValidatingFun</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="k">fun</span><span class="p">(),</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">           </span><span class="nv">Default</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">term</span><span class="p">())</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nv">Value</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">term</span><span class="p">().</span>
</span></code></pre></div>
<p>The function is used to get a value <code>Value</code> of a configuration option
<code>Option</code>. The <code>ValidatingFun</code> is a validating function described in
the previous section and <code>Default</code> is the default value if the option
is not defined in the config.</p>
<h2 id="using-xmpp-library">Using XMPP library<a class="headerlink" href="#using-xmpp-library" title="Permanent link">&para;</a></h2>
<h3 id="xmpp-module">xmpp module<a class="headerlink" href="#xmpp-module" title="Permanent link">&para;</a></h3>
<p>Prior to version 16.12, ejabberd used to operate with <code>#xmlel{}</code>
packets directly: <a href="https://github.com/processone/fast_xml">fast_xml</a>
API functions have been used for manipulating with <code>#xmlel{}</code> packets
(such as <code>fast_xml:get_subtag/2</code>, <code>fast_xml:get_attr_s/2</code>,
<code>fast_xml:get_path_s/2</code> and so on) as well as some functions from
<code>jlib.erl</code> module.</p>
<p>This is now deprecated and actually not possible. Instead, the new API
functions are used from brand new <a href="https://github.com/processone/xmpp">xmpp</a>
library.</p>
<blockquote>
<p><strong>NOTE</strong>: although direct calling of <code>fast_xml</code> API is deprecated,
there are still two useful functions: <code>fxml_stream:parse_element/1</code> and
<code>fxml:element_to_binary/1</code>. You can use these functions for
(de)serialization of data stored on disc or in a database.</p>
</blockquote>
<p>The library is built on top of <code>XMPP Codec</code>: a number of
decoding/encoding modules automatically generated by <a href="https://github.com/processone/fast_xml/blob/master/src/fxml_gen.erl">Fast XML
generator</a>
from the specification file
<a href="https://github.com/processone/xmpp/blob/master/specs/xmpp_codec.spec">xmpp_codec.spec</a>.
The goal is to avoid manual processing of XML trees and, instead, using
well-typed auto-generated structures defined in
<a href="https://github.com/processone/xmpp/blob/master/include/xmpp.hrl">xmpp_codec.hrl</a>.
Every particular XML packet within some namespace has to have a
specification defined in <code>xmpp_codec.spec</code>. The advantage of such
approach is that you tell the generator <em>what</em> to parse instead of
taming <code>fast_xml</code> library <em>how</em> to parse.</p>
<blockquote>
<p><strong>NOTE</strong>: describing how to write XMPP codec specification is out of
scope of this guide</p>
<p><strong>WARNING</strong>: you should never use functions from <code>xmpp_codec.erl</code> module
directly: use functions from <code>xmpp.erl</code> module. The same is true for
header files: do <strong>NOT</strong> include <code>xmpp_codec.hrl</code> -- include <code>xmpp.hrl</code> instead</p>
</blockquote>
<h4 id="xmpp-codec">XMPP codec<a class="headerlink" href="#xmpp-codec" title="Permanent link">&para;</a></h4>
<p>Once a raw XML packet is parsed by <code>ejabberd_receiver.erl</code> into <code>#xmlel{}</code> record,
it's passed to <code>xmpp_stream_in.erl</code> module, where decoding of <code>#xmlel{}</code> into
<code>xmpp_element()</code> format (i.e. into well-known record type defined in <code>xmpp_codec.hrl</code>)
is performed (refer to <a href="#xmpp-stream-layer">XMPP Stream Layer</a> section for details).
At that level "lazy" decoding is applied: only top-level element is decoded.
For example, an <code>xmlel()</code> packet</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nl">#xmlel</span><span class="p">{</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;message&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">       </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="o">&lt;&lt;</span><span class="s">&quot;type&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="o">&lt;&lt;</span><span class="s">&quot;chat&quot;</span><span class="o">&gt;&gt;</span><span class="p">}],</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">       </span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nl">#xmlel</span><span class="p">{</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;composing&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">                          </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="o">&lt;&lt;</span><span class="s">&quot;xmlns&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">                                    </span><span class="o">&lt;&lt;</span><span class="s">&quot;http://jabber.org/protocol/chatstates&quot;</span><span class="o">&gt;&gt;</span><span class="p">}],</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">                          </span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]}]}</span>
</span></code></pre></div>
<p>is decoded into the following <code>xmpp_element()</code>:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nl">#message</span><span class="p">{</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;&gt;&gt;</span><span class="p">,</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chat</span><span class="p">,</span><span class="n">lang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;&gt;&gt;</span><span class="p">,</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">         </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span><span class="n">thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">         </span><span class="n">sub_els</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nl">#xmlel</span><span class="p">{</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;composing&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">                           </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="o">&lt;&lt;</span><span class="s">&quot;xmlns&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">                                     </span><span class="o">&lt;&lt;</span><span class="s">&quot;http://jabber.org/protocol/chatstates&quot;</span><span class="o">&gt;&gt;</span><span class="p">}],</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">                           </span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]}],</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">         </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span>
</span></code></pre></div>
<p>Note that the sub-element is still in <code>xmlel()</code> format. This "semi-decoded" packet
is then passed upstream (at the <a href="#routing-layer">Routing Layer</a>). Thus, a programmer
should explicitly decode sub-elements if needed. To accomplish this one can use the
following function:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nn">xmpp</span><span class="p">:</span><span class="nf">decode</span><span class="p">(</span><span class="nv">El</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">xmlel</span><span class="p">(),</span><span class="w"> </span><span class="nv">Namespace</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">binary</span><span class="p">(),</span><span class="w"> </span><span class="p">[</span><span class="nv">Option</span><span class="p">])</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">xmpp_element</span><span class="p">()</span><span class="err">`</span>
</span></code></pre></div>
<p>where the only supported <code>Option</code> is <code>ignore_els</code>: with this option lazy decoding
is performed. By default, full decoding is applied, i.e. all known sub-elements get
decoded. <code>Namespace</code> is a "top-level" namespace: it should be provided only if
<code>&lt;&lt;"xmlns"&gt;&gt;</code> attribute is omitted in <code>El</code>, otherwise decoding would fail (see below).</p>
<p>There is also <code>xmpp:decode(El :: xmlel()) -&gt; xmpp_element()</code> function, which is
a short-hand for <code>xmpp:decode(El, ?NS_CLIENT, [])</code> (where <code>?NS_CLIENT</code> is a
predefined namespace for <code>&lt;&lt;"jabber:client"&gt;&gt;</code>, see <a href="#namespaces">Namespaces</a>
section).</p>
<p>Both functions might <strong>fail</strong> with <code>{xmpp_codec, Why}</code> exception. The value of <code>Why</code>
can be used to format the failure reason into human readable description using
<code>xmpp:format_error/1</code> function, e.g., using sub-element from example <code>#message{}</code>
above, we can write:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">try</span><span class="w"> </span><span class="nn">xmpp</span><span class="p">:</span><span class="nf">decode</span><span class="p">(</span><span class="nv">El</span><span class="p">)</span><span class="w"> </span><span class="k">of</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="nl">#chatstate</span><span class="p">{}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ChatState</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">process_chatstate</span><span class="p">(</span><span class="nv">ChatState</span><span class="p">)</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="k">catch</span><span class="w"> </span><span class="p">_:{</span><span class="n">xmpp_codec</span><span class="p">,</span><span class="w"> </span><span class="nv">Why</span><span class="p">}</span><span class="w"> </span><span class="o">-&gt;</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="nv">Text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nn">xmpp</span><span class="p">:</span><span class="nf">format_error</span><span class="p">(</span><span class="nv">Why</span><span class="p">),</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="o">?</span><span class="nv">ERROR_MSG</span><span class="p">(</span><span class="s">&quot;failed to decode element: </span><span class="si">~s</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nv">Txt</span><span class="p">])</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="k">end</span>
</span></code></pre></div>
<p>To apply reverse operation use <code>xmpp:encode/2</code> functions:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nn">xmpp</span><span class="p">:</span><span class="nf">encode</span><span class="p">(</span><span class="nv">Pkt</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">xmpp_element</span><span class="p">(),</span><span class="w"> </span><span class="nv">Namespace</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">binary</span><span class="p">())</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nv">El</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">xmlel</span><span class="p">()</span>
</span></code></pre></div>
<p>There is also
<code>xmpp:encode(Pkt :: xmpp_element()) -&gt; El :: xmlel()</code> function which
is a short-hand for <code>xmpp:encode(Pkt, &lt;&lt;&gt;&gt;)</code>.</p>
<p><code>Namespace</code> is a "top-level" namespace: it is used to tell the codec whether
to include <code>&lt;&lt;"xmlns"&gt;&gt;</code> attribute into resulting <code>#xmlel{}</code> element or not --
if the <code>Pkt</code> is within the same <code>Namespace</code>, <code>&lt;&lt;"xmlns"&gt;&gt;</code> attribute will be
omitted in the result. For example:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="o">&gt;</span><span class="w"> </span><span class="n">rr</span><span class="p">(</span><span class="n">xmpp</span><span class="p">).</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="p">...</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="o">&gt;</span><span class="w"> </span><span class="nv">Msg</span><span class="p">.</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="nl">#message</span><span class="p">{</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;&gt;&gt;</span><span class="p">,</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chat</span><span class="p">,</span><span class="n">lang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;&gt;&gt;</span><span class="p">,</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">         </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span><span class="n">thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">         </span><span class="n">sub_els</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nl">#chatstate</span><span class="p">{</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">composing</span><span class="p">}],</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">         </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="o">&gt;</span><span class="w"> </span><span class="nn">xmpp</span><span class="p">:</span><span class="nf">encode</span><span class="p">(</span><span class="nv">Msg</span><span class="p">).</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="nl">#xmlel</span><span class="p">{</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;message&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">       </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="o">&lt;&lt;</span><span class="s">&quot;type&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="o">&lt;&lt;</span><span class="s">&quot;chat&quot;</span><span class="o">&gt;&gt;</span><span class="p">},</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">                </span><span class="p">{</span><span class="o">&lt;&lt;</span><span class="s">&quot;xmlns&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="o">&lt;&lt;</span><span class="s">&quot;jabber:client&quot;</span><span class="o">&gt;&gt;</span><span class="p">}],</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">       </span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nl">#xmlel</span><span class="p">{</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;composing&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">                          </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="o">&lt;&lt;</span><span class="s">&quot;xmlns&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">                                    </span><span class="o">&lt;&lt;</span><span class="s">&quot;http://jabber.org/protocol/chatstates&quot;</span><span class="o">&gt;&gt;</span><span class="p">}],</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">                          </span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]}]}</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="o">&gt;</span><span class="w"> </span><span class="nn">xmpp</span><span class="p">:</span><span class="nf">encode</span><span class="p">(</span><span class="nv">Msg</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;jabber:client&quot;</span><span class="o">&gt;&gt;</span><span class="p">).</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="nl">#xmlel</span><span class="p">{</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;message&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">       </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="o">&lt;&lt;</span><span class="s">&quot;type&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="o">&lt;&lt;</span><span class="s">&quot;chat&quot;</span><span class="o">&gt;&gt;</span><span class="p">}],</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w">       </span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nl">#xmlel</span><span class="p">{</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;composing&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">                          </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="o">&lt;&lt;</span><span class="s">&quot;xmlns&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">                                    </span><span class="o">&lt;&lt;</span><span class="s">&quot;http://jabber.org/protocol/chatstates&quot;</span><span class="o">&gt;&gt;</span><span class="p">}],</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">                          </span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]}]}</span>
</span></code></pre></div>
<blockquote>
<p><strong>NOTE</strong>: <code>xmpp:encode/1,2</code> functions would never fail as long as the
provided input is a valid <code>xmpp_element()</code> with valid values of its record
fields. Use dialyzer checks of your code for validation.</p>
<p><strong>NOTE</strong>: there is no need to explicitly decode a sub-element of an IQ
passed into an <a href="#iq-handlers">IQ handler</a> because decoding is performed
inside <code>gen_iq_handler.erl</code> module and a handler actually will never
receive malformed sub-elements.</p>
</blockquote>
<p>Luckily, there is a helper function for sub-elements decoding, described
in the next section and in a lot of cases it's more convenient to use it.</p>
<h4 id="getting-sub-elements">Getting sub-elements<a class="headerlink" href="#getting-sub-elements" title="Permanent link">&para;</a></h4>
<p>Once a programmer gets a stanza in <code>xmpp_element()</code> format, (s)he might
want to get its subelement. To accomplish this the following function
can be used:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nn">xmpp</span><span class="p">:</span><span class="nf">get_subtag</span><span class="p">(</span><span class="nv">Stanza</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">stanza</span><span class="p">(),</span><span class="w"> </span><span class="nv">Tag</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">xmpp_element</span><span class="p">())</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nv">Pkt</span><span class="w"> </span><span class="p">::</span><span class="w"> </span><span class="n">xmpp_element</span><span class="p">()</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="n">false</span>
</span></code></pre></div>
<p>This function finds a <code>Tag</code> by its well-known record inside sub-elements of
the <code>Stanza</code>. It automatically performs decoding (if needed) and returns either
found <code>xmpp_element()</code> or <code>false</code> if no elements have matched. Note that
the function doesn't fail if some of sub-elements are invalid.</p>
<p>Example:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="o">&gt;</span><span class="w"> </span><span class="n">rr</span><span class="p">(</span><span class="n">xmpp</span><span class="p">).</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="p">...</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="o">&gt;</span><span class="w"> </span><span class="nv">Msg</span><span class="p">.</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="nl">#message</span><span class="p">{</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;&gt;&gt;</span><span class="p">,</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chat</span><span class="p">,</span><span class="n">lang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;&gt;&gt;</span><span class="p">,</span><span class="n">from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">         </span><span class="n">to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span><span class="n">subject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span><span class="n">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span><span class="n">thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">undefined</span><span class="p">,</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">         </span><span class="n">sub_els</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nl">#xmlel</span><span class="p">{</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="s">&quot;composing&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">                           </span><span class="n">attrs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[{</span><span class="o">&lt;&lt;</span><span class="s">&quot;xmlns&quot;</span><span class="o">&gt;&gt;</span><span class="p">,</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">                                     </span><span class="o">&lt;&lt;</span><span class="s">&quot;http://jabber.org/protocol/chatstates&quot;</span><span class="o">&gt;&gt;</span><span class="p">}],</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">                           </span><span class="n">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[]}],</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">         </span><span class="n">meta</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="o">&gt;</span><span class="w"> </span><span class="nn">xmpp</span><span class="p">:</span><span class="nf">get_subtag</span><span class="p">(</span><span class="nv">Msg</span><span class="p">,</span><span class="w"> </span><span class="nl">#chatstate</span><span class="p">{</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">composing</span><span class="p">}).</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="nl">#chatstate</span><span class="p">{</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">composing</span><span class="p">}</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="o">&gt;</span><span class="w"> </span><span class="nn">xmpp</span><span class="p">:</span><span class="nf">get_subtag</span><span class="p">(</span><span class="nv">Msg</span><span class="p">,</span><span class="w"> </span><span class="nl">#chatstate</span><span class="p">{</span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inactive</span><span class="p">}).</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="n">false</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="o">&gt;</span><span class="w"> </span><span class="nn">xmpp</span><span class="p">:</span><span class="nf">get_subtag</span><span class="p">(</span><span class="nv">Msg</span><span class="p">,</span><span class="w"> </span><span class="nl">#disco_info</span><span class="p">{}).</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="n">false</span>
</span></code></pre></div>
<h4 id="setting-and-removing-sub-elements">Setting and removing sub-elements<a class="headerlink" href="#setting-and-removing-sub-elements" title="Permanent link">&para;</a></h4>
<p>In order to inject a sub-element into or delete one from arbitrary
<code>stanza()</code> one can use <code>xmpp:set_subtag/2</code> and <code>xmpp:remove_subtag/2</code>
respectively.</p>
<h4 id="from-and-to">from and to<a class="headerlink" href="#from-and-to" title="Permanent link">&para;</a></h4>
<p>Every <code>stanza()</code> element has <code>from</code> and <code>to</code> record fields. In order to
get/set them one can manipulate with these record fields directly, e.g.
via <code>Msg#message.from</code> or <code>Pres#presence.to</code> expressions, or, use
<code>xmpp:get_from/1</code>, <code>xmpp:get_to/1</code>, <code>xmpp:set_from/2</code>, <code>xmpp:set_to/2</code>
and <code>xmpp:set_from_to/3</code> functions, depending on which approach is
more convenient in the current situation.</p>
<blockquote>
<p><strong>NOTE</strong>: although in general <code>from</code> and <code>to</code> fields may have <code>undefined</code>
values, these fields are always filled with correct <code>#jid{}</code> records at
<a href="#xmpp-stream-layer">XMPP Stream Layer</a>, thus, it is safe to assume
that the fields always possess valid <code>#jid{}</code> values.</p>
</blockquote>
<h4 id="metadata">Metadata<a class="headerlink" href="#metadata" title="Permanent link">&para;</a></h4>
<p>Every <code>stanza()</code> element has <code>meta</code> field represented as a <code>map()</code>.
It's useful when there is a need to attach some metadata to the stanza
before routing it further.
A programmer can manipulate with this field directly using
<a href="https://www.erlang.org/doc/apps/stdlib/maps.html">maps</a> module,
or use <code>xmpp:get_meta/1,2,3</code>, <code>xmpp:set_meta/2</code>, <code>xmpp:put_meta/3</code>,
<code>xmpp:update_meta/3</code> and <code>xmpp:del_meta/2</code> functions, which is almost
always more convenient (except pattern matching).</p>
<h4 id="text-elements">Text elements<a class="headerlink" href="#text-elements" title="Permanent link">&para;</a></h4>
<p>Some <code>xmpp_element()</code>s has fields defined in <code>[#text{}]</code> format. The example
is <code>#message.body</code> and <code>#presence.status</code> fields. To avoid writing a lot
of extracting code the following functions can be used: <code>xmpp:mk_text/1,2</code> to
convert some binary text written in some language into <code>[#text{}]</code> term,
or <code>xmpp:get_text/1,2</code> to extract binary text from the <code>[#text{}]</code> element
by a language.</p>
<h4 id="generating-errors">Generating errors<a class="headerlink" href="#generating-errors" title="Permanent link">&para;</a></h4>
<p>In order to generate stanza errors or stream errors <code>xmpp:err_/0,2</code>
or <code>xmpp:serr_*/0,2</code> can be used respectively, such as
<code>xmpp:err_service_unavailable()</code> or <code>xmpp:serr_not_authorized()</code>.
If a stanza should be bounced back with an error, <code>xmpp:make_error/2</code>
function can be used</p>
<h4 id="namespaces">Namespaces<a class="headerlink" href="#namespaces" title="Permanent link">&para;</a></h4>
<p>There are many predefined macros for XML namespaces in
<a href="https://github.com/processone/xmpp/blob/master/include/ns.hrl">ns.hrl</a>.
However, this file must <strong>NOT</strong> be included, as it's already included
in <code>xmpp.hrl</code>.</p>
<p>A function <code>xmpp:get_ns/1</code> can be used to retrieve a namespace
from <code>xmpp_element()</code> or from <code>xmlel()</code> directly:</p>
<div class="language-erlang highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="o">&gt;</span><span class="w"> </span><span class="n">rr</span><span class="p">(</span><span class="n">xmpp</span><span class="p">).</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="p">...</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="o">&gt;</span><span class="w"> </span><span class="nn">xmpp</span><span class="p">:</span><span class="nf">get_ns</span><span class="p">(</span><span class="nl">#message</span><span class="p">{}).</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="o">&lt;&lt;</span><span class="s">&quot;jabber:client&quot;</span><span class="o">&gt;&gt;</span><span class="p">.</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="o">&gt;</span><span class="w"> </span><span class="nn">xmpp</span><span class="p">:</span><span class="nf">get_ns</span><span class="p">(</span><span class="nn">xmpp</span><span class="p">:</span><span class="nf">encode</span><span class="p">(</span><span class="nl">#presence</span><span class="p">{})).</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="o">&lt;&lt;</span><span class="s">&quot;jabber:client&quot;</span><span class="o">&gt;&gt;</span><span class="p">.</span>
</span></code></pre></div>
<h3 id="jid-module">jid module<a class="headerlink" href="#jid-module" title="Permanent link">&para;</a></h3>
<p><code>jid.erl</code> module provides functions to work with XMPP addresses (aka "JIDs").
There are two common types of internal representation of JIDs:</p>
<ul>
<li><code>jid()</code>: a JID is represented by a record <code>#jid{}</code> defined in
  <a href="https://github.com/processone/xmpp/blob/master/include/jid.hrl">jid.hrl</a></li>
<li><code>ljid()</code>: a JID is represented by a tuple <code>{User, Server, Resource}</code> where
  <code>User</code>, <code>Server</code> and <code>Resource</code> are stringprepped version of a nodepart,
  namepart and resourcepart of a JID respectively. This representation is useful to
  use for JIDs comparison and when a JID should be used as a key (in a Mnesia
  database, ETS table, etc.)</li>
</ul>
<p>The most notable functions in this module are:</p>
<ul>
<li><code>decode(Input :: binary()) -&gt; jid()</code>:
  decodes binary data into <code>jid()</code>. Fails with <code>{bad_jid, Input}</code> otherwise.</li>
<li><code>encode(JID :: jid() | ljid()) -&gt; binary()</code>:
  encodes <code>JID</code> into binary data</li>
<li><code>remove_resource(JID :: jid() | ljid()) -&gt; jid() | ljid()</code>:
  removes resource part of a <code>JID</code></li>
<li><code>replace_resource(JID :: jid() | ljid(), Resource :: binary()) -&gt; jid() | ljid()</code>:
  replaces resource part of a <code>JID</code></li>
<li><code>tolower(JID :: jid() | ljid()) -&gt; ljid()</code>:
  transforms <code>JID</code> into <code>ljid()</code> representation</li>
<li><code>make(LJID :: ljid() | jid()) -&gt; jid()</code>:
  transforms <code>LJID</code> into <code>jid()</code> representation</li>
</ul>
<p>Inspect exported functions of
<a href="https://github.com/processone/xmpp/blob/master/src/jid.erl">jid.erl</a>
for more details.</p>
<h2 id="external-authentication">External Authentication<a class="headerlink" href="#external-authentication" title="Permanent link">&para;</a></h2>
<p>You can configure ejabberd to use as authentication method an external script,
as described in the Administrator section:
<a href="../../admin/configuration/authentication/#external-script">External Script</a>.</p>
<p>Let's see the interface between ejabberd and your script,
and several example scripts.
There are also several old <a href="https://www.ejabberd.im/extauth/">example scripts</a>.</p>
<h3 id="extauth-interface">Extauth Interface<a class="headerlink" href="#extauth-interface" title="Permanent link">&para;</a></h3>
<p>The external authentication script follows the
<a href="https://www.erlang.org/doc/system/c_portdriver.html">Erlang port driver API</a>.</p>
<p>That script is supposed to do these actions, in an infinite loop:</p>
<ul>
<li>
<p>read from stdin: <code>AABBBBBBBBB.....</code></p>
</li>
<li>
<p><code>A</code>: 2 bytes of length data (a short in network byte order)</p>
</li>
<li>
<p><code>B</code>: a string of length found in A that contains operation in
        plain text operation are as follows:</p>
<ul>
<li>
<p><code>auth:User:Server:Password</code> (check if a username/password pair
        is correct)</p>
</li>
<li>
<p><code>isuser:User:Server</code> (check if it’s a valid user)</p>
</li>
<li>
<p><code>setpass:User:Server:Password</code> (set user’s password)</p>
</li>
<li>
<p><code>tryregister:User:Server:Password</code> (try to register an
        account)</p>
</li>
<li>
<p><code>removeuser:User:Server</code> (remove this account)</p>
</li>
<li>
<p><code>removeuser3:User:Server:Password</code> (remove this account if the
        password is correct)</p>
</li>
</ul>
</li>
<li>
<p>write to stdout: <code>AABB</code></p>
</li>
<li>
<p><code>A</code>: the number <code>2</code> (coded as a short, which is bytes length of
        following result)</p>
</li>
<li>
<p><code>B</code>: the result code (coded as a short), should be <code>1</code> for
        success/valid, or <code>0</code> for failure/invalid</p>
</li>
</ul>
<p>As you noticed, the <code>:</code> character is used to separate the fields.
This is possible because the User and Server fields can't contain the <code>:</code> character;
and Password can have that character, but is always the last field.
So it is always possible to parse the input characters unambiguously.</p>
<h3 id="perl-example-script">Perl Example Script<a class="headerlink" href="#perl-example-script" title="Permanent link">&para;</a></h3>
<p>This is a simple example Perl script;
for example if the file is copied to the path <code>/etc/ejabberd/check_pass_null.pl</code>
then configure ejabberd like this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nt">auth_method</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">external</span><span class="p p-Indicator">]</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="nt">extauth_program</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ejabberd/check_pass_null.pl</span>
</span></code></pre></div>
<p>Content of <code>check_pass_null.pl</code>:</p>
<div class="language-perl highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="ch">#!/usr/bin/perl</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="k">use</span><span class="w"> </span><span class="nn">Unix::Syslog</span><span class="w"> </span><span class="sx">qw(:macros :subs)</span><span class="p">;</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="k">my</span><span class="w"> </span><span class="nv">$domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s">&quot;example.com&quot;</span><span class="p">;</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">   </span><span class="c1"># my $rin = &#39;&#39;,$rout;</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">   </span><span class="c1"># vec($rin,fileno(STDIN),1) = 1;</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">   </span><span class="c1"># $ein = $rin;</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">   </span><span class="c1"># my $nfound = select($rout=$rin,undef,undef,undef);</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="w">    </span><span class="k">my</span><span class="w"> </span><span class="nv">$buf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">    </span><span class="n">syslog</span><span class="w"> </span><span class="n">LOG_INFO</span><span class="p">,</span><span class="s">&quot;waiting for packet&quot;</span><span class="p">;</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">    </span><span class="k">my</span><span class="w"> </span><span class="nv">$nread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sysread</span><span class="w"> </span><span class="bp">STDIN</span><span class="p">,</span><span class="nv">$buf</span><span class="p">,</span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">syslog</span><span class="w"> </span><span class="n">LOG_INFO</span><span class="p">,</span><span class="s">&quot;port closed&quot;</span><span class="p">;</span><span class="w"> </span><span class="nb">exit</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">unless</span><span class="w"> </span><span class="nv">$nread</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a><span class="w">    </span><span class="k">my</span><span class="w"> </span><span class="nv">$len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">unpack</span><span class="w"> </span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="nv">$buf</span><span class="p">;</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a><span class="w">    </span><span class="k">my</span><span class="w"> </span><span class="nv">$nread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sysread</span><span class="w"> </span><span class="bp">STDIN</span><span class="p">,</span><span class="nv">$buf</span><span class="p">,</span><span class="nv">$len</span><span class="p">;</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a><span class="w">    </span><span class="k">my</span><span class="w"> </span><span class="p">(</span><span class="nv">$op</span><span class="p">,</span><span class="nv">$user</span><span class="p">,</span><span class="nv">$host</span><span class="p">,</span><span class="nv">$password</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">split</span><span class="w"> </span><span class="sr">/:/</span><span class="p">,</span><span class="nv">$buf</span><span class="p">;</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a><span class="w">    </span><span class="c1">#$user =~ s/\./\//og;</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a><span class="w">    </span><span class="k">my</span><span class="w"> </span><span class="nv">$jid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;$user\@$domain&quot;</span><span class="p">;</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a><span class="w">    </span><span class="k">my</span><span class="w"> </span><span class="nv">$result</span><span class="p">;</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a><span class="w">    </span><span class="n">syslog</span><span class="p">(</span><span class="n">LOG_INFO</span><span class="p">,</span><span class="s">&quot;request (%s)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">$op</span><span class="p">);</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a><span class="w">  </span><span class="n">SWITCH:</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a><span class="w"> </span><span class="nv">$op</span><span class="w"> </span><span class="ow">eq</span><span class="w"> </span><span class="s">&#39;auth&#39;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a><span class="w">   </span><span class="p">{</span>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a><span class="w">             </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a><span class="w">   </span><span class="p">},</span><span class="k">last</span><span class="w"> </span><span class="n">SWITCH</span><span class="p">;</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a><span class="w"> </span><span class="nv">$op</span><span class="w"> </span><span class="ow">eq</span><span class="w"> </span><span class="s">&#39;setpass&#39;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-26-36"><a id="__codelineno-26-36" name="__codelineno-26-36" href="#__codelineno-26-36"></a><span class="w">   </span><span class="p">{</span>
</span><span id="__span-26-37"><a id="__codelineno-26-37" name="__codelineno-26-37" href="#__codelineno-26-37"></a><span class="w">             </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-26-38"><a id="__codelineno-26-38" name="__codelineno-26-38" href="#__codelineno-26-38"></a><span class="w">   </span><span class="p">},</span><span class="k">last</span><span class="w"> </span><span class="n">SWITCH</span><span class="p">;</span>
</span><span id="__span-26-39"><a id="__codelineno-26-39" name="__codelineno-26-39" href="#__codelineno-26-39"></a>
</span><span id="__span-26-40"><a id="__codelineno-26-40" name="__codelineno-26-40" href="#__codelineno-26-40"></a><span class="w">        </span><span class="nv">$op</span><span class="w"> </span><span class="ow">eq</span><span class="w"> </span><span class="s">&#39;isuser&#39;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-26-41"><a id="__codelineno-26-41" name="__codelineno-26-41" href="#__codelineno-26-41"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-26-42"><a id="__codelineno-26-42" name="__codelineno-26-42" href="#__codelineno-26-42"></a><span class="w">             </span><span class="c1"># password is null. Return 1 if the user $user\@$domain exitst.</span>
</span><span id="__span-26-43"><a id="__codelineno-26-43" name="__codelineno-26-43" href="#__codelineno-26-43"></a><span class="w">             </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-26-44"><a id="__codelineno-26-44" name="__codelineno-26-44" href="#__codelineno-26-44"></a><span class="w">          </span><span class="p">},</span><span class="k">last</span><span class="w"> </span><span class="n">SWITCH</span><span class="p">;</span>
</span><span id="__span-26-45"><a id="__codelineno-26-45" name="__codelineno-26-45" href="#__codelineno-26-45"></a>
</span><span id="__span-26-46"><a id="__codelineno-26-46" name="__codelineno-26-46" href="#__codelineno-26-46"></a><span class="w">        </span><span class="nv">$op</span><span class="w"> </span><span class="ow">eq</span><span class="w"> </span><span class="s">&#39;tryregister&#39;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-26-47"><a id="__codelineno-26-47" name="__codelineno-26-47" href="#__codelineno-26-47"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-26-48"><a id="__codelineno-26-48" name="__codelineno-26-48" href="#__codelineno-26-48"></a><span class="w">             </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-26-49"><a id="__codelineno-26-49" name="__codelineno-26-49" href="#__codelineno-26-49"></a><span class="w">          </span><span class="p">},</span><span class="k">last</span><span class="w"> </span><span class="n">SWITCH</span><span class="p">;</span>
</span><span id="__span-26-50"><a id="__codelineno-26-50" name="__codelineno-26-50" href="#__codelineno-26-50"></a>
</span><span id="__span-26-51"><a id="__codelineno-26-51" name="__codelineno-26-51" href="#__codelineno-26-51"></a><span class="w">        </span><span class="nv">$op</span><span class="w"> </span><span class="ow">eq</span><span class="w"> </span><span class="s">&#39;removeuser&#39;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-26-52"><a id="__codelineno-26-52" name="__codelineno-26-52" href="#__codelineno-26-52"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-26-53"><a id="__codelineno-26-53" name="__codelineno-26-53" href="#__codelineno-26-53"></a><span class="w">             </span><span class="c1"># password is null. Return 1 if the user $user\@$domain exitst.</span>
</span><span id="__span-26-54"><a id="__codelineno-26-54" name="__codelineno-26-54" href="#__codelineno-26-54"></a><span class="w">             </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-26-55"><a id="__codelineno-26-55" name="__codelineno-26-55" href="#__codelineno-26-55"></a><span class="w">          </span><span class="p">},</span><span class="k">last</span><span class="w"> </span><span class="n">SWITCH</span><span class="p">;</span>
</span><span id="__span-26-56"><a id="__codelineno-26-56" name="__codelineno-26-56" href="#__codelineno-26-56"></a>
</span><span id="__span-26-57"><a id="__codelineno-26-57" name="__codelineno-26-57" href="#__codelineno-26-57"></a><span class="w">        </span><span class="nv">$op</span><span class="w"> </span><span class="ow">eq</span><span class="w"> </span><span class="s">&#39;removeuser3&#39;</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-26-58"><a id="__codelineno-26-58" name="__codelineno-26-58" href="#__codelineno-26-58"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-26-59"><a id="__codelineno-26-59" name="__codelineno-26-59" href="#__codelineno-26-59"></a><span class="w">             </span><span class="nv">$result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-26-60"><a id="__codelineno-26-60" name="__codelineno-26-60" href="#__codelineno-26-60"></a><span class="w">          </span><span class="p">},</span><span class="k">last</span><span class="w"> </span><span class="n">SWITCH</span><span class="p">;</span>
</span><span id="__span-26-61"><a id="__codelineno-26-61" name="__codelineno-26-61" href="#__codelineno-26-61"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-26-62"><a id="__codelineno-26-62" name="__codelineno-26-62" href="#__codelineno-26-62"></a><span class="w">    </span><span class="k">my</span><span class="w"> </span><span class="nv">$out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">pack</span><span class="w"> </span><span class="s">&quot;nn&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="nv">$result</span><span class="w"> </span><span class="p">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-26-63"><a id="__codelineno-26-63" name="__codelineno-26-63" href="#__codelineno-26-63"></a><span class="w">    </span><span class="nb">syswrite</span><span class="w"> </span><span class="bp">STDOUT</span><span class="p">,</span><span class="nv">$out</span><span class="p">;</span>
</span><span id="__span-26-64"><a id="__codelineno-26-64" name="__codelineno-26-64" href="#__codelineno-26-64"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-65"><a id="__codelineno-26-65" name="__codelineno-26-65" href="#__codelineno-26-65"></a>
</span><span id="__span-26-66"><a id="__codelineno-26-66" name="__codelineno-26-66" href="#__codelineno-26-66"></a><span class="n">closelog</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="python-example-script">Python Example Script<a class="headerlink" href="#python-example-script" title="Permanent link">&para;</a></h3>
<p>Example Python script:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="ch">#!/usr/bin/python</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">read_from_stdin</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>  <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span> <span class="s1">&#39;buffer&#39;</span><span class="p">):</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>    <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>    <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">bytes</span><span class="p">)</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">():</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>    <span class="p">(</span><span class="n">pkt_size</span><span class="p">,)</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&gt;H&#39;</span><span class="p">,</span> <span class="n">read_from_stdin</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>    <span class="n">pkt</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">pkt_size</span><span class="p">)</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>    <span class="n">cmd</span> <span class="o">=</span> <span class="n">pkt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>    <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;auth&#39;</span><span class="p">:</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>        <span class="n">u</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pkt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>        <span class="k">if</span> <span class="n">u</span> <span class="o">==</span> <span class="s2">&quot;wrong&quot;</span><span class="p">:</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>            <span class="n">write</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#__codelineno-27-20"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#__codelineno-27-21"></a>            <span class="n">write</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#__codelineno-27-22"></a>    <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;isuser&#39;</span><span class="p">:</span>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#__codelineno-27-23"></a>        <span class="n">u</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pkt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#__codelineno-27-24"></a>        <span class="k">if</span> <span class="n">u</span> <span class="o">==</span> <span class="s2">&quot;wrong&quot;</span><span class="p">:</span>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#__codelineno-27-25"></a>            <span class="n">write</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26" href="#__codelineno-27-26"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27" href="#__codelineno-27-27"></a>            <span class="n">write</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28" href="#__codelineno-27-28"></a>    <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;setpass&#39;</span><span class="p">:</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29" href="#__codelineno-27-29"></a>        <span class="n">u</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pkt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30" href="#__codelineno-27-30"></a>        <span class="n">write</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31" href="#__codelineno-27-31"></a>    <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;tryregister&#39;</span><span class="p">:</span>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32" href="#__codelineno-27-32"></a>        <span class="n">u</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pkt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-27-33"><a id="__codelineno-27-33" name="__codelineno-27-33" href="#__codelineno-27-33"></a>        <span class="n">write</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-27-34"><a id="__codelineno-27-34" name="__codelineno-27-34" href="#__codelineno-27-34"></a>    <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;removeuser&#39;</span><span class="p">:</span>
</span><span id="__span-27-35"><a id="__codelineno-27-35" name="__codelineno-27-35" href="#__codelineno-27-35"></a>        <span class="n">u</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pkt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-27-36"><a id="__codelineno-27-36" name="__codelineno-27-36" href="#__codelineno-27-36"></a>        <span class="n">write</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-27-37"><a id="__codelineno-27-37" name="__codelineno-27-37" href="#__codelineno-27-37"></a>    <span class="k">elif</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s1">&#39;removeuser3&#39;</span><span class="p">:</span>
</span><span id="__span-27-38"><a id="__codelineno-27-38" name="__codelineno-27-38" href="#__codelineno-27-38"></a>        <span class="n">u</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pkt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-27-39"><a id="__codelineno-27-39" name="__codelineno-27-39" href="#__codelineno-27-39"></a>        <span class="n">write</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-27-40"><a id="__codelineno-27-40" name="__codelineno-27-40" href="#__codelineno-27-40"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-41"><a id="__codelineno-27-41" name="__codelineno-27-41" href="#__codelineno-27-41"></a>        <span class="n">write</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-27-42"><a id="__codelineno-27-42" name="__codelineno-27-42" href="#__codelineno-27-42"></a>
</span><span id="__span-27-43"><a id="__codelineno-27-43" name="__codelineno-27-43" href="#__codelineno-27-43"></a><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
</span><span id="__span-27-44"><a id="__codelineno-27-44" name="__codelineno-27-44" href="#__codelineno-27-44"></a>    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span id="__span-27-45"><a id="__codelineno-27-45" name="__codelineno-27-45" href="#__codelineno-27-45"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00\x02\x00\x01</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-27-46"><a id="__codelineno-27-46" name="__codelineno-27-46" href="#__codelineno-27-46"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-27-47"><a id="__codelineno-27-47" name="__codelineno-27-47" href="#__codelineno-27-47"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x00\x02\x00\x00</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="__span-27-48"><a id="__codelineno-27-48" name="__codelineno-27-48" href="#__codelineno-27-48"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="__span-27-49"><a id="__codelineno-27-49" name="__codelineno-27-49" href="#__codelineno-27-49"></a>
</span><span id="__span-27-50"><a id="__codelineno-27-50" name="__codelineno-27-50" href="#__codelineno-27-50"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-27-51"><a id="__codelineno-27-51" name="__codelineno-27-51" href="#__codelineno-27-51"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-27-52"><a id="__codelineno-27-52" name="__codelineno-27-52" href="#__codelineno-27-52"></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-27-53"><a id="__codelineno-27-53" name="__codelineno-27-53" href="#__codelineno-27-53"></a>            <span class="n">read</span><span class="p">()</span>
</span><span id="__span-27-54"><a id="__codelineno-27-54" name="__codelineno-27-54" href="#__codelineno-27-54"></a>    <span class="k">except</span> <span class="n">struct</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
</span><span id="__span-27-55"><a id="__codelineno-27-55" name="__codelineno-27-55" href="#__codelineno-27-55"></a>        <span class="k">pass</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: ejabberd for Developers">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                ejabberd for Developers
              </div>
            </div>
          </a>
        
        
          
          <a href="../extending-ejabberd/pubsub/" class="md-footer__link md-footer__link--next" aria-label="Next:  Pubsub Dev">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                 Pubsub Dev
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2008 - 2025 <a href="https://www.process-one.net" target="_blank" rel="noopener">ProcessOne</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/processone/ejabberd" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/processone/docker-ejabberd/" target="_blank" rel="noopener" title="Docker Registry" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg>
    </a>
  
    
    
      
    
    
    
    <a href="https://social.process-one.net/@ejabberd" target="_blank" rel="noopener me" title="Mastodon" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.5 102.5 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5m-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.process-one.net/" target="_blank" rel="noopener" title="ProcessOne Website" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m225.8 468.2-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144 39.4-7.6 79.7 1.5 111.8 24.1 9 6.4 17.4 13.8 25 22.3 4.2-4.8 8.7-9.2 13.5-13.3 3.7-3.2 7.5-6.2 11.5-9 32.1-22.6 72.4-31.7 111.8-24.2C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9M239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20-.1-.1c-23.1-25.9-58-37.7-92-31.2-46.6 8.9-80.2 49.5-80.2 96.9v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268a102.7 102.7 0 0 0 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9-34-6.5-69 5.4-92 31.2l-.1.1-.1.1-17.8 20c-.3.4-.7.7-1 1.1-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "toc.follow", "navigation.top", "navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.footer", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotate", "content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>